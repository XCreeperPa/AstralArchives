# 星穹智库（AstralArchives）

星穹铁道设定（角色、剧情、世界观）智能分析系统。

本项目通过高并发爬虫自动抓取 https://wiki.biligame.com/sr/ 的 MediaWiki 分类与页面内容，聚焦于角色、剧情、世界观等设定内容，不涉及战斗、数值、配队分析。

## 功能简介
- 基于 aiohttp 的高性能并发爬虫
- rich 交互式命令行界面，实时进度显示
- 自动重试与异常处理机制
- 分类可配置，按需抓取
- 分类与页面源码本地化存储
- 完整的日志记录系统

## 技术特性
- 异步并发：使用 aiohttp 进行高性能网络请求
- 自动重试：网络异常自动重试，默认最多 5 次
- 高并发控制：自适应并发量（分类32并发，页面256并发）
- 实时进度：rich 提供的优雅进度显示
- 异常处理：详细的错误日志，失败统计
- 本地化存储：自动创建目录结构，保存页面内容

## 使用说明

### 环境准备
本项目推荐使用 [uv](https://github.com/astral-sh/uv) 进行依赖与虚拟环境管理。

- 初始化虚拟环境：`uv venv`
- 安装依赖：`uv pip install -r uv.toml`

### 启动方式
- 交互式（默认）：
  ```bash
  .venv/bin/python main.py
  ```
  自动按 config/categories.json 启用分类批量爬取。

- 指定分类（命令行参数）：
  ```bash
  .venv/bin/python main.py 分类1 分类2 ...
  ```
  只爬取指定分类（如：`NPC`）。

### 目录结构
- `./config/` 分类配置文件（首次运行自动生成）
- `./wiki/` 分类与页面源码存储
- `./log/` 运行日志，包含失败记录
  - 日志文件格式：`YYYYMMDD_HHMMSS.log`

### 进度显示
- 全局进度：显示所有页面的总体完成情况
- 分类进度：显示当前分类的完成情况
- 耗时统计：显示操作耗时
- 失败统计：显示失败的分类和页面

### 错误处理
- 网络错误自动重试
- 失败信息实时显示
- 详细错误日志
- 最终统计报告

如需添加依赖，请编辑 `uv.toml` 并用 `uv pip install`。

## 性能优化
- 使用 aiohttp 替代 httpx 提升并发性能
- 自适应并发控制避免请求过载
- 异步日志系统避免 I/O 阻塞
- 简化了文件操作逻辑

---

> 本项目仅用于学习与交流，内容版权归米哈游及原作者所有。
