# 星穹智库（AstralArchives）

> 星穹铁道设定（角色、剧情、世界观）智能分析与检索系统

---

## 项目简介

星穹智库是一个面向《崩坏：星穹铁道》Wiki数据的智能分析与检索平台，支持爬取、清洗、嵌入、向量化检索等全流程，适合知识库、AI问答、内容分析等场景。

---

## 主要特性

- **Rich 交互式命令行主菜单**：一键查看说明、启动爬虫、分类管理、数据清洗、嵌入、检索。
- **高并发异步爬虫**：支持多分类并发抓取，自动本地化存储页面源码。
- **结构化数据清洗**：支持光锥、角色、任务等分类，统一输出结构化 JSON。
- **全流程进度条与友好提示**：所有核心流程均有进度条与异常提示。
- **向量化嵌入与检索**：支持分片嵌入，全部内容、元数据、向量索引自包含于单一 zip 文件，检索时无需依赖外部元数据。
- **配置与日志分离**：所有配置、日志、wiki源码、清洗结果、向量库均有独立目录，结构清晰。
- **依赖管理现代化**：推荐 `venv` + `uv`，安装快、兼容性好。

---

## 目录结构

```
AstralArchives/
├─ crawler/                # 爬虫主流程与实现
├─ datacleaner/            # 数据清洗主流程与各分类模型
├─ ui/                     # rich命令行界面与各功能入口
├─ config/                 # 分类配置、API密钥
├─ wiki/                   # 页面源码本地化存储（自动生成）
├─ wiki_cleaned/           # 清洗后结构化 json（自动生成）
├─ db/                     # 向量数据库（如 wiki_allinone.zip）
├─ log/                    # 运行日志（自动生成）
├─ main.py                 # 入口，只负责调度主菜单
├─ README.md               # 项目说明
├─ pyproject.toml          # 依赖与元数据配置
```

---

## 快速开始

1. **环境准备**
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   pip install uv
   uv sync
   ```
2. **配置 API 密钥**
   - 复制 `config/api_keys.template.json` 为 `config/api_keys.json`，填写你的嵌入API密钥。
3. **启动主菜单**
   ```bash
   python main.py
   ```
4. **按菜单提示操作**
   - 查看说明、启动爬虫、管理分类、清洗数据、嵌入数据、检索数据。

---

## 向量数据库说明

- 嵌入后所有向量、元数据、内容、索引均自包含于 `db/wiki_allinone.zip`，无需任何外部元数据文件。
- 检索时仅需该 zip 文件即可返回分片级元数据。
- 支持分片嵌入，自动规避API长度限制。

---

## 主要命令与功能

- `python RAGCUI.py`：进入 rich 智能问答界面
- `python RAGCUI.py --test`：自动批量测试典型问题，输出至 output/A1.md、B1.md、C1.md
- `python devCUI.py`：
  - 查看 README
  - 启动爬虫（自动抓取已启用分类）
  - 管理分类（批量启用/禁用）
  - 清洗数据（结构化输出 json，带进度条）
  - 数据嵌入（分片、进度条、全自包含 zip 向量库）
  - 检索数据（输入关键词，返回前十条分片元数据）

---

## 依赖与适配

- Python 3.8+
- 依赖见 `pyproject.toml`，推荐用 `uv` 安装
- 需联网访问嵌入API（如 BAAI/bge-m3）

---

## 免责声明

- 本项目仅用于学习与交流，内容版权归米哈游及原作者所有。
- 向量化API需自备密钥，使用第三方API请遵守相关服务条款。
